<div class="container">

  <mat-card id="description">
    <h4>{{courseDetail?.course_description}}</h4>
    <button *ngIf="userRole != 'docent'" class="desc-button" mat-flat-button color="warn"
            (click)="exitCourse(courseDetail.course_name, courseDetail.course_id)">Kurs
      verlassen
    </button>
    <button class="desc-button" *ngIf="userRole === 'admin' || userRole === 'docent' || userRole === 'tutor'"

            mat-flat-button color="accent" (click)="updateCourse()">Kurs bearbeiten

    </button>
    <button class="desc-button" *ngIf="userRole === 'admin' || userRole === 'docent' || userRole === 'tutor'"
            mat-flat-button color="accent" (click)="createTask(courseDetail)">Aufgabe erstellen
    </button>
  </mat-card>

  <!-- task list-->
  <mat-card *ngFor="let task of courseTasks" class="task-container" id="{{task.task_id}}">
    <div class="title">
      <h4>{{task.task_name}}</h4>
      <span class="filler"></span>
      <div>{{task.result_date | date: 'medium'}}</div>
      <ng-template #result id="result">
        <mat-icon id="passed" *ngIf="task.passed && task.result_date">check_box</mat-icon>
        <mat-icon id="failed" *ngIf="!task.passed && task.result_date">clear</mat-icon>
        <mat-icon id="not-done" *ngIf="!task.result_date">check_box_outline_blank
        </mat-icon>
      </ng-template>
      <mat-spinner *ngIf="processing[task.task_id] || (task.submit_date && !task.result_date); else result"
                   diameter="20"></mat-spinner>
    </div>
    <mat-card-subtitle>
    </mat-card-subtitle>
    <mat-card-content>
      <h5>{{task.deadline | date:'medium'}}</h5>
      <p>{{task.task_description}}</p>
      <mat-divider></mat-divider>
      <div class="user-input">

        <!-- Submission -->
        <div class="result">
          <p *ngIf="task.submission_data">{{task.submission_data}}</p>
          <p *ngIf="task.file">{{task.file}}</p>
          <span class="filler"></span>
          <p>{{task.submit_date| date:'medium'}}</p>

        </div>
        <p id="task-result-text"  class="{{task.passed}}" *ngIf="task.result">{{task.result}} {{task.exitcode}}</p>
        <mat-radio-group class="solution-type" [(ngModel)]="submissionAsFile[task.task_id]">
          <mat-radio-button [value]="true">Datei</mat-radio-button>
          <mat-radio-button [value]="false">Text</mat-radio-button>
        </mat-radio-group>
        <input *ngIf="submissionAsFile[task.task_id]" type="file"
               (change)="getSubmissionFile($event.target.files[0], task)">

        <mat-form-field *ngIf="!submissionAsFile[task.task_id]" class="user-input-text" appearance="outline">
          <mat-label>Abgabe Text</mat-label>
          <input matInput type="text" [(ngModel)]="submissionData[task.task_id]">
        </mat-form-field>

      </div>

      <!-- Action buttons -->
      <mat-card-actions>
        <button *ngIf="userRole === 'docent' || userRole === 'tutor'" mat-flat-button color="warn"
                (click)="deleteTask(task)">LÃ¶schen
        </button>
        <button *ngIf="userRole === 'docent' || userRole === 'tutor'" mat-flat-button color="accent"
                (click)="updateTask(task)">Bearbeiten
        </button>
        <button [disabled]="deadlineTask[task.task_id]" mat-flat-button color="accent" (click)="submission(courseDetail.course_id, task)">Abgeben</button>
      </mat-card-actions>
    </mat-card-content>
  </mat-card>


</div>

